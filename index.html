<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√¥ ph·ªèng song song: Tin gi·∫£ vs Tin ki·ªÉm ch·ª©ng</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0b1220;color:#eef5ff;margin:0}
    header{padding:14px 18px;background:linear-gradient(90deg,#08203a,#062033);display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0;color:#7fd1ff}
    .controls{padding:12px 18px;display:flex;gap:10px;align-items:center;background:#071426}
    button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
    .btn-run{background:#ff6b6b;color:#120000}
    .btn-run2{background:#34d399;color:#00220a}
    .btn-both{background:linear-gradient(90deg,#ff6b6b,#34d399);color:#041216}
    .btn-reset{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#cbd5e1}
    .wrap{display:flex;gap:14px;padding:14px}
    #viz{flex:1;background:linear-gradient(180deg,#051428,#07182a);padding:12px;border-radius:10px}
    #sidebar{width:360px}
    svg{width:100%;height:520px;border-radius:8px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:8px;margin-bottom:12px}
    .statrow{display:flex;gap:8px}
    .stat{flex:1;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;text-align:center}
    .legend{display:flex;gap:8px;align-items:center;margin-top:8px}
    .dot{width:12px;height:12px;border-radius:50%}
    footer{padding:10px 18px;font-size:13px;color:#99a3b3}
    label{font-size:14px;color:#cfeaff}
  </style>
</head>
<body>
  <header>
    <svg width="40" height="40"><rect width="40" height="40" rx="8" fill="#0b6efd"/></svg>
    <h1>M√¥ ph·ªèng SONG SONG ‚Äî Tin gi·∫£ (ƒê·ªé) vs Tin ki·ªÉm ch·ª©ng (XANH)</h1>
  </header>

  <div class="controls">
    <button class="btn-run" id="btnFake">üì§ Ch·∫°y: Tin gi·∫£ (ƒë·ªè)</button>
    <button class="btn-run2" id="btnReal">üîç Ch·∫°y: Tin ki·ªÉm ch·ª©ng (xanh)</button>
    <button class="btn-both" id="btnBoth">‚ñ∂Ô∏è Ch·∫°y c√πng l√∫c (C·∫£ 2)</button>
    <button class="btn-reset" id="btnReset">üîÅ ƒê·∫∑t l·∫°i</button>
    <label style="margin-left:12px"><input type="checkbox" id="autoLoop"> T·ª± ƒë·ªông l·∫∑p</label>
  </div>

  <div class="wrap">
    <div id="viz" class="panel">
      <svg id="network"></svg>
    </div>

    <div id="sidebar">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong style="color:#bfe8ff">S·ªê LI·ªÜU TR·ª∞C TI·∫æP</strong>
          <div style="font-size:12px;color:#9fb6c9">Th·ªùi gian th·ª±c</div>
        </div>
        <div class="statrow" style="margin-top:10px">
          <div class="stat">
            <div style="font-size:20px;color:#ffd6d6" id="countFake">0</div>
            <div style="font-size:13px;color:#9fb6c9">Ng∆∞·ªùi ti·∫øp c·∫≠n (Tin gi·∫£)</div>
          </div>
          <div class="stat">
            <div style="font-size:20px;color:#b7ffd6" id="countReal">0</div>
            <div style="font-size:13px;color:#9fb6c9">Ng∆∞·ªùi ti·∫øp c·∫≠n (Tin ki·ªÉm ch·ª©ng)</div>
          </div>
        </div>

        <div style="margin-top:12px">
          <canvas id="chart" width="320" height="180"></canvas>
        </div>

        <div class="legend" style="margin-top:10px">
          <div class="item"><span class="dot" style="background:#ffd6d6"></span> Tin gi·∫£ (lan nhanh)</div>
          <div class="item"><span class="dot" style="background:#b7ffd6"></span> Tin ki·ªÉm ch·ª©ng (lan ch·∫≠m)</div>
        </div>
      </div>

      <div class="panel">
        <strong style="color:#bfe8ff">C√°ch d√πng nhanh</strong>
        <ol style="color:#bcd9ea;text-align:left;margin-top:8px">
          <li>Nh·∫•n <em>Ch·∫°y c√πng l√∫c</em> ƒë·ªÉ quan s√°t c·∫£ 2 k·ªãch b·∫£n song song.</li>
          <li>B·∫•m <em>ƒê·∫∑t l·∫°i</em> ƒë·ªÉ ch·∫°y l·∫°i. Tick <em>T·ª± ƒë·ªông l·∫∑p</em> n·∫øu mu·ªën demo li√™n t·ª•c.</li>
          <li>Quan s√°t n√∫t ƒë·ªè/ xanh, ƒë∆∞·ªùng n·ªëi s√°ng, v√† ƒë·ªì th·ªã hai ƒë∆∞·ªùng so s√°nh.</li>
        </ol>
      </div>

      <div class="panel">
        <strong style="color:#bfe8ff">√ù nghƒ©a ng·∫Øn</strong>
        <p style="color:#bcd9ea;text-align:left">M√¥ ph·ªèng cho th·∫•y c√πng m·ªôt th·ªùi ƒëi·ªÉm ngu·ªìn tin c√≥ th·ªÉ t·∫°o ra hai m·ª©c lan truy·ªÅn kh√°c nhau t√πy c√°ch ng∆∞·ªùi ti·∫øp nh·∫≠n ph·∫£n ·ª©ng (c·∫£m t√≠nh ‚Äî chia s·∫ª ngay / c·∫©n tr·ªçng ‚Äî ki·ªÉm ch·ª©ng). ƒêi·ªÅu n√†y tr·ª±c quan h√≥a c∆° ch·∫ø thao t√∫ng t√¢m l√Ω.</p>
      </div>
    </div>
  </div>

  <footer>
    L∆∞u file l√† <strong>index.html</strong> ‚Üí m·ªü tr√¨nh duy·ªát. Mu·ªën m√¨nh xu·∫•t b·∫£n GIF/MP4 cho slide kh√¥ng?
  </footer>

<script>
/* ========== Thi·∫øt l·∫≠p m·∫°ng ========== */
const N = 36;
const svg = d3.select("#network").attr("viewBox","0 0 900 520");
const W = 900, H = 520;
const nodes = d3.range(N).map(i=>({id:i}));
let links = [];
for(let i=0;i<N*2;i++){ let a=Math.floor(Math.random()*N); let b=Math.floor(Math.random()*N); if(a!==b) links.push({source:a,target:b}); }

const sim = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links).id(d=>d.id).distance(85).strength(0.3))
  .force("charge", d3.forceManyBody().strength(-160))
  .force("center", d3.forceCenter(W/2,H/2))
  .alphaDecay(0.02);

const link = svg.append("g").selectAll("line").data(links).enter().append("line").attr("stroke","#082233").attr("stroke-width",1);
const node = svg.append("g").selectAll("circle").data(nodes).enter().append("circle").attr("r",9).attr("fill","#6f7f8f").attr("stroke","#021226");

sim.on("tick", ()=>{
  link.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y).attr("x2",d=>d.target.x).attr("y2",d=>d.target.y);
  node.attr("cx",d=>d.x).attr("cy",d=>d.y);
});

/* ========== Chart setup (2 ƒë∆∞·ªùng) ========== */
const ctx = document.getElementById('chart').getContext('2d');
const chartData = { labels: [], datasets: [
  { label: 'Tin gi·∫£', data: [], borderColor:'#ff6b6b', backgroundColor:'rgba(255,107,107,0.12)', tension:0.3 },
  { label: 'Tin ki·ªÉm ch·ª©ng', data: [], borderColor:'#34d399', backgroundColor:'rgba(52,211,153,0.12)', tension:0.3 }
]};
const myChart = new Chart(ctx, { type:'line', data: chartData, options:{responsive:true, plugins:{legend:{display:true}} } });

/* ========== Tr·∫°ng th√°i ========== */
let visitedFake = new Set(), visitedReal = new Set();
let runningFake=false, runningReal=false;
let step = 0;
let autoInterval = null;

/* reset to√†n b·ªô */
function resetAll(){
  runningFake = runningReal = false;
  visitedFake.clear(); visitedReal.clear();
  step = 0;
  chartData.labels.length = 0;
  chartData.datasets[0].data.length = 0;
  chartData.datasets[1].data.length = 0;
  myChart.update();
  d3.selectAll('circle').transition().duration(200).attr('fill','#6f7f8f').attr('r',9);
  d3.selectAll('line').transition().duration(200).attr('stroke','#082233').attr('stroke-width',1);
  document.getElementById('countFake').innerText = 0;
  document.getElementById('countReal').innerText = 0;
}

/* h√†m lan truy·ªÅn chung nh∆∞ng ri√™ng tham s·ªë cho 2 k·ªãch b·∫£n */
function propagate(seedIndex, setVisited, color, params, highlightColor){
  // seed lu√¥n l√† n√∫t v√†ng (v·∫Ω tr∆∞·ªõc), nh∆∞ng m·ªói k·ªãch b·∫£n c√≥ seed kh√°c ƒë·ªÉ tr√°nh xung ƒë·ªôt
  // params: {prob, delay, max}
  const neighbors = links.filter(l=>l.source.id===seedIndex).map(l=>l.target.id).concat(links.filter(l=>l.target.id===seedIndex).map(l=>l.source.id));
  // initial spread from seed
  neighbors.forEach(id=>{
    if(Math.random() < params.prob && setVisited.size < params.max){
      setVisited.add(id);
      d3.select(node.nodes()[id]).attr('fill', color);
    }
  });

  step++; chartData.labels.push('t' + step);
  chartData.datasets[0].data.push(visitedFake.size);
  chartData.datasets[1].data.push(visitedReal.size);
  myChart.update();
  document.getElementById('countFake').innerText = visitedFake.size;
  document.getElementById('countReal').innerText = visitedReal.size;

  // queue-driven spreading
  const queue = Array.from(setVisited);
  function stepSpread(q){
    if(q.length === 0) return;
    const next = [];
    q.forEach(curId=>{
      const neigh = links.filter(l=>l.source.id===curId).map(l=>l.target.id).concat(links.filter(l=>l.target.id===curId).map(l=>l.source.id));
      neigh.forEach(nb=>{
        // if already visited by this scenario, ignore
        if(setVisited.has(nb)) return;
        // don't let nodes beyond max participate
        if(setVisited.size >= params.max) return;
        if(Math.random() < params.prob){
          setVisited.add(nb);
          // visual node pulse
          d3.select(node.nodes()[nb])
            .transition().duration(120).attr('r',15).attr('fill', color)
            .transition().duration(220).attr('r',9);
          // highlight connecting lines
          links.forEach((l,i)=>{
            if( (l.source.id===curId && l.target.id===nb) || (l.target.id===curId && l.source.id===nb) ){
              d3.select(link.nodes()[i])
                .transition().duration(120).attr('stroke', highlightColor).attr('stroke-width',3)
                .transition().duration(300).attr('stroke','#082233').attr('stroke-width',1);
            }
          });
          next.push(nb);
        }
      });
    });
    // update chart + counters
    step++; chartData.labels.push('t' + step);
    chartData.datasets[0].data.push(visitedFake.size);
    chartData.datasets[1].data.push(visitedReal.size);
    myChart.update();
    document.getElementById('countFake').innerText = visitedFake.size;
    document.getElementById('countReal').innerText = visitedReal.size;
    // continue
    if(step > 80 || setVisited.size >= params.max) return;
    setTimeout(()=> stepSpread(next), params.delay);
  }
  setTimeout(()=> stepSpread(queue), params.delay);
}

/* ch·∫°y t·ª´ng k·ªãch b·∫£n ri√™ng */
function runFake(){
  // choose seed 0 for fake; mark it gold visually
  resetSeedVisuals();
  d3.select(node.nodes()[0]).attr('fill','gold').attr('r',13);
  runningFake = true; visitedFake.clear();
  propagate(0, visitedFake, '#ff6b6b', {prob:0.85, delay:150, max:N}, '#ff9a9a');
}
function runReal(){
  resetSeedVisuals();
  // choose seed 1 for real
  d3.select(node.nodes()[1]).attr('fill','gold').attr('r',13);
  runningReal = true; visitedReal.clear();
  propagate(1, visitedReal, '#34d399', {prob:0.25, delay:480, max:Math.max(6,Math.floor(N*0.2))}, '#8ee7be');
}

/* ch·∫°y c√πng l√∫c: seed 0 fake, seed 1 real */
function runBoth(){
  resetAll();
  // mark both seeds
  d3.select(node.nodes()[0]).attr('fill','gold').attr('r',13);
  d3.select(node.nodes()[1]).attr('fill','gold').attr('r',13);
  runningFake = runningReal = true;
  visitedFake.clear(); visitedReal.clear();
  // Start both
  propagate(0, visitedFake, '#ff6b6b', {prob:0.85, delay:150, max:N}, '#ff9a9a');
  setTimeout(()=> propagate(1, visitedReal, '#34d399', {prob:0.25, delay:480, max:Math.max(6,Math.floor(N*0.2))}, '#8ee7be'), 80);
}

/* helper to reset seed visuals if user runs single */
function resetSeedVisuals(){
  d3.selectAll('circle').attr('r',9);
  d3.selectAll('circle').attr('fill','#6f7f8f');
}

/* auto loop */
document.getElementById('autoLoop').addEventListener('change', (e)=>{
  if(e.target.checked){
    // auto run both every 6 seconds
    runBoth();
    autoInterval = setInterval(()=>{ runBoth(); }, 7000);
  } else {
    clearInterval(autoInterval);
  }
});

document.getElementById('btnFake').addEventListener('click', ()=>{
  resetAll();
  runFake();
});
document.getElementById('btnReal').addEventListener('click', ()=>{
  resetAll();
  runReal();
});
document.getElementById('btnBoth').addEventListener('click', ()=>{
  resetAll();
  runBoth();
});
document.getElementById('btnReset').addEventListener('click', ()=>{
  resetAll();
  document.getElementById('autoLoop').checked = false;
  clearInterval(autoInterval);
});

/* init */
resetAll();
</script>
</body>
</html>
