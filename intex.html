<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mô phỏng Thao túng Tâm lý - Giáo dục KHKT & Hành vi</title>
  <meta name="description" content="Trang mô phỏng trực quan minh hoạ chuỗi lan truyền thông tin, dấu hiệu thao túng truyền thông và cách phòng tránh. Dùng cho báo cáo KHKT và thuyết trình." />
  <style>
    /* Theme */
    :root{ --bg:#0f1724; --panel:#0b1220; --card:#0f1a2b; --accent:#2fb6ff; --muted:#9fb2c8; --glass: rgba(255,255,255,0.04);} 
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#071025 0%, #081426 60%); color:#e6f2ff}
    .wrap{max-width:1200px;margin:28px auto;padding:20px;display:grid;grid-template-columns:420px 1fr;gap:20px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    header h1{margin:0;font-size:18px;letter-spacing:0.2px}
    header p{margin:6px 0 0;font-size:13px;color:var(--muted)}

    /* left column */
    .controls{display:flex;flex-direction:column;gap:12px}
    label{font-size:13px;color:var(--muted)}
    select,input[type=range],button{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .btn-row{display:flex;gap:8px}
    button.primary{background:linear-gradient(90deg,var(--accent),#67e8f9);color:#012; font-weight:600}
    .small{font-size:12px;color:var(--muted)}

    /* simulation area */
    .sim-area{display:flex;flex-direction:column;height:640px}
    #canvasWrap{flex:1;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#082034 0%, #071523 100%);position:relative}
    svg#sim{width:100%;height:100%;display:block}

    /* sidebar info */
    .info{padding:12px;display:flex;flex-direction:column;gap:8px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:12px;border-radius:10px}
    .legend{display:flex;gap:8px;align-items:center}
    .dot{width:14px;height:14px;border-radius:50%}
    .dot.good{background:#53d3a7}
    .dot.sus{background:#ffd76b}
    .dot.bad{background:#ff8b8b}
    .timeline{height:90px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:8px;padding:8px;display:flex;align-items:end;gap:6px}
    .bar{width:6px;border-radius:6px;background:linear-gradient(180deg,#86e3ff,#2fb6ff)}

    footer{grid-column:1/3;margin-top:8px;text-align:center;color:var(--muted);font-size:12px}

    /* responsive */
    @media (max-width:980px){.wrap{grid-template-columns:1fr;padding:12px}.sim-area{height:520px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <h1>Mô phỏng Thao túng Tâm lý — Giáo dục (KHKT & Hành vi)</h1>
        <p>Hiển thị mạng xã hội thu nhỏ: người (nút), kết nối (liên kết). Thử các kịch bản, xem chỉ số và cách phòng tránh.</p>
      </header>

      <section class="controls card" aria-label="Điều khiển mô phỏng">
        <label>Số nút (quy mô mạng)</label>
        <select id="nodeCount"><option>25</option><option>40</option><option selected>60</option><option>100</option></select>

        <label>Tốc độ bước (ms)</label>
        <input id="speed" type="range" min="150" max="1500" value="600" />
        <div class="btn-row">
          <button id="resetBtn">Khởi tạo lại</button>
          <button id="seedBtn">Chọn nguồn (1)</button>
          <button id="seedMultiBtn">Chọn nhiều nguồn</button>
        </div>
        <div class="btn-row">
          <button id="startBtn" class="primary">Bắt đầu</button>
          <button id="pauseBtn">Tạm dừng</button>
          <button id="stepBtn">Bước 1 lần</button>
        </div>
        <div class="small">Ghi chú: click vào một nút để thay đổi trạng thái (Verified → Nghi ngờ → Sai). Double-click nền để reset toàn bộ trạng thái.</div>
      </section>

      <section class="card info" aria-label="Giải thích mô phỏng">
        <strong>Ý nghĩa trạng thái</strong>
        <div class="legend"><div class="dot good"></div><div class="small">Thông tin xác thực (được kiểm chứng)</div></div>
        <div class="legend"><div class="dot sus"></div><div class="small">Thông tin nghi ngờ / chưa kiểm chứng</div></div>
        <div class="legend"><div class="dot bad"></div><div class="small">Thông tin sai / giả</div></div>

        <strong>Giải thích mô phỏng</strong>
        <div class="small">Mạng được tạo ngẫu nhiên (mô phỏng xã hội). Mỗi bước, tin sai có xác suất truyền tới người tiếp xúc. Một số nút có thể tự phục hồi (kiểm chứng) — đại diện cho cơ chế phản hồi/kiểm chứng.</div>

        <strong>Cách phòng tránh (tóm tắt)</strong>
        <ol class="small">
          <li>Đọc tiêu đề + nguồn. Kiểm tra nguồn chính thống.</li>
          <li>Không chia sẻ vội — dừng 10s để kiểm chứng.</li>
          <li>Dùng fact-check và báo cáo bài đăng sai.</li>
        </ol>
      </section>
    </div>

    <div class="panel sim-area">
      <div id="canvasWrap" class="card">
        <svg id="sim" viewBox="0 0 1000 640" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Mô phỏng mạng xã hội"></svg>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px">
        <div class="card" style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center"><strong>Chỉ số thời gian thực</strong><div id="timer" class="small">Bước: 0</div></div>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center"><div style="flex:1"><div id="counts" class="small">Xác thực: 0 • Nghi ngờ: 0 • Sai: 0</div></div></div>
        </div>

        <div class="card" style="width:280px">
          <strong>Biểu đồ số lượng (thời gian)</strong>
          <div id="chart" class="timeline" aria-hidden="true"></div>
        </div>
      </div>

    </div>

    <footer>Trang web giáo dục do hệ thống tạo — dùng cho thuyết trình KHKT. Không dùng để thao túng thật.</footer>
  </div>

  <script>
    // --- config & utilities ---
    const svg = document.getElementById('sim');
    let nodes = [], links = [];
    let timer = null, stepCount = 0; let running=false;
    const rand = (min,max) => Math.random()*(max-min)+min;

    function makeNetwork(count=60){
      nodes = []; links = [];
      for(let i=0;i<count;i++) nodes.push({id:i, x:rand(80,920), y:rand(80,560), state:'good'});
      // connect small-world-ish
      for(let i=0;i<count;i++){
        const deg = Math.max(2, Math.round(rand(2,6)));
        for(let j=0;j<deg;j++){ let k = Math.floor(rand(0,count)); if(k!==i) links.push({source:i,target:k}); }
      }
      // dedupe
      links = links.filter((v,i,a)=>i===a.findIndex(e=>e.source===v.source && e.target===v.target));
    }

    function render(){
      svg.innerHTML='';
      // links
      for(const l of links){ const a=nodes[l.source], b=nodes[l.target];
        const line = document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1',a.x);line.setAttribute('y1',a.y);line.setAttribute('x2',b.x);line.setAttribute('y2',b.y);
        line.setAttribute('stroke','rgba(150,185,220,0.15)'); line.setAttribute('stroke-width',1.4); svg.appendChild(line);
      }
      // nodes
      for(const n of nodes){ const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        const c=document.createElementNS('http://www.w3.org/2000/svg','circle'); c.setAttribute('cx',n.x); c.setAttribute('cy',n.y); c.setAttribute('r',10);
        c.setAttribute('stroke','rgba(255,255,255,0.06)'); c.setAttribute('stroke-width',1.2);
        if(n.state==='good') c.setAttribute('fill','#53d3a7'); else if(n.state==='sus') c.setAttribute('fill','#ffd76b'); else c.setAttribute('fill','#ff8b8b');
        g.appendChild(c);
        const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.setAttribute('x',n.x); t.setAttribute('y',n.y+22); t.setAttribute('font-size',9);
        t.setAttribute('text-anchor','middle'); t.setAttribute('fill','rgba(230,242,255,0.85)'); t.textContent = '#'+n.id;
        g.appendChild(t);
        g.addEventListener('click',()=>{ if(n.state==='good') n.state='sus'; else if(n.state==='sus') n.state='bad'; else n.state='good'; render(); updateCounts(); });
        svg.appendChild(g);
      }
    }

    function seedOne(){ const idx=Math.floor(rand(0,nodes.length)); nodes[idx].state='bad'; render(); updateCounts(); }
    function seedMulti(){ const used=new Set(); while(used.size<3) used.add(Math.floor(rand(0,nodes.length))); for(const i of used) nodes[i].state='bad'; render(); updateCounts(); }

    // spread logic (educational & simplified)
    function stepSpread(){
      const toBe = new Set();
      for(const l of links){ const a=nodes[l.source], b=nodes[l.target];
        if(a.state==='bad' && b.state!=='bad'){ if(Math.random()<0.24) toBe.add(b.id); }
        if(b.state==='bad' && a.state!=='bad'){ if(Math.random()<0.24) toBe.add(a.id); }
        if(a.state==='sus' && b.state==='bad' && Math.random()<0.12) toBe.add(a.id);
        if(b.state==='sus' && a.state==='bad' && Math.random()<0.12) toBe.add(b.id);
      }
      // apply
      toBe.forEach(id=>nodes[id].state='bad');
      // random check: a few nodes become verified
      if(Math.random()<0.07){ const idx=Math.floor(rand(0,nodes.length)); nodes[idx].state='good'; }
      // small movement
      nodes.forEach(n=>{ n.x = Math.max(60, Math.min(940, n.x + rand(-6,6))); n.y = Math.max(60, Math.min(600, n.y + rand(-5,5))); });
      stepCount++; document.getElementById('timer').textContent = 'Bước: '+stepCount; render(); updateCounts(); pushChart();
    }

    // counts & simple timeline chart
    let history = [];
    function updateCounts(){ const c = {good:0,sus:0,bad:0}; nodes.forEach(n=>c[n.state]++); document.getElementById('counts').textContent = `Xác thực: ${c.good} • Nghi ngờ: ${c.sus} • Sai: ${c.bad}`; }
    function pushChart(){ const c = nodes.reduce((acc,n)=>{ acc[n.state] = (acc[n.state]||0)+1; return acc },{}); history.push(c.bad||0); if(history.length>24) history.shift(); renderChart(); }
    function renderChart(){ const el=document.getElementById('chart'); el.innerHTML=''; const max = Math.max(1, ...history); for(let v of history){ const h = Math.round((v/max) * 72) + 6; const b = document.createElement('div'); b.className='bar'; b.style.height = h+'px'; el.appendChild(b); } }

    // controls
    document.getElementById('resetBtn').addEventListener('click', ()=>{ const nc = parseInt(document.getElementById('nodeCount').value); makeNetwork(nc); stepCount=0; history=[]; updateCounts(); renderChart(); render(); });
    document.getElementById('seedBtn').addEventListener('click', ()=>{ seedOne(); });
    document.getElementById('seedMultiBtn').addEventListener('click', ()=>{ seedMulti(); });
    document.getElementById('startBtn').addEventListener('click', ()=>{ if(running) return; running=true; const speed = Number(document.getElementById('speed').value); timer = setInterval(stepSpread, speed); });
    document.getElementById('pauseBtn').addEventListener('click', ()=>{ running=false; if(timer) clearInterval(timer); timer=null; });
    document.getElementById('stepBtn').addEventListener('click', ()=>{ stepSpread(); });
    document.getElementById('speed').addEventListener('input',(e)=>{ if(running){ clearInterval(timer); timer = setInterval(stepSpread, Number(e.target.value)); } });

    // init
    makeNetwork(60); render(); updateCounts(); renderChart();

    // accessibility: keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key===' '){ e.preventDefault(); if(running){ document.getElementById('pauseBtn').click(); } else { document.getElementById('startBtn').click(); } }
      if(e.key==='r') document.getElementById('resetBtn').click();
    });

    // helpful tooltip when first load
    setTimeout(()=>{ const tip = document.createElement('div'); tip.textContent='Tip: Nhấn khoảng trắng để chạy/tạm dừng, double-click nền để reset trạng thái.'; tip.style.position='absolute'; tip.style.left='18px'; tip.style.bottom='18px'; tip.style.padding='8px 12px'; tip.style.borderRadius='8px'; tip.style.background='rgba(0,0,0,0.4)'; tip.style.fontSize='12px'; document.getElementById('canvasWrap').appendChild(tip); setTimeout(()=>tip.remove(),6000); },800);
  </script>
</body>
</html>